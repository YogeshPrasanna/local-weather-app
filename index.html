<html>

<head>
    <title>Local Weather</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-alpha/css/bootstrap.min.css" />
    <link rel="stylesheet" href="main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" />
    <link href="https://fonts.googleapis.com/css?family=Francois+One|Muli:400i|Bungee+Inline|PT+Sans" rel="stylesheet">
</head>

<body>
    <div class="weatherapp col-sm-12">
        <div class="col-sm-12 header">
            <h2>Local Weather App</h2></div>
        <div class="col-sm-12 pagecontent">
            <div class="col-sm-12 weatherbox">
                <div id="area"></div>
                <div id="temp"></div>
                <div id="feel"></div>
                <div id="humid"></div>
            </div>
        </div>
    </div>
    <!-- footer -->
    <div class="col-sm-12 footer">
        <div class="col-sm-8 col-xs-12"><i class="fa fa-copyright" aria-hidden="true"></i> Yogesh Prasanna</div>
        <div id="contact" class="col-sm-4 col-xs-12 footer-contact pull-right"> <span style="color: #FFDD00">contact | </span> <i class="fa fa-facebook" aria-hidden="true" style="color:#4867AA"></i> <a href="https://www.facebook.com/yogeshp.letsrock" target="_blank" style="color: #ED9095; text-decoration: none;">Facebook</a> | <i class="fa fa-twitter" aria-hidden="true" style="color:#1DA1F2"></i> <a href="https://twitter.com/yogeshpletsrock" target="_blank" style="color: #ED9095; text-decoration: none;"> Twitter </a> | <i class="fa fa-instagram" aria-hidden="true" style="color:pink"></i> <a href="https://www.instagram.com/yogeshprasanna/" target="_blank" style="color: #ED9095; text-decoration: none;"> Instagram </a> </div>
    </div>
    <!-- scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.js" type="text/javascript"></script>
    <script type="text/javascript">
    $(document).ready(function() {

        var callLocation = function callLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    catchData(position.coords.latitude, position.coords.longitude);
                });
            } else {
                alert("please share the location");
            }
        }

        function catchData(latitude, longitude) {
            var url = "http://api.openweathermap.org/data/2.5/forecast/city?lat=" + latitude + "&lon=" + longitude + "&APPID=2898d089486f107dc2565963788c9842";
            console.log(url);
            var output = $.ajax({
                url: url,
                type: 'GET',
                dataType: 'jsonp',
                data: {},
                success: function(data) {
                    console.log(data);
                    var temp = Math.ceil(data.list[0].main.temp_max - 273.15),
                        desc = data.list[0].weather[0]['description'],
                        humidity = data.list[0].main.humidity;

                    $('#feel').html(desc);
                    $('#temp').html(temp + "&deg;c");
                    $('#humid').html("Humidity : " + humidity + " %");

                    if (desc === 'clear sky' || desc === 'few clouds' || desc === 'sky is clear' || desc == 'scattered clouds') {
                        $('body').css({
                            'background-image': 'url(https://static.pexels.com/photos/116717/pexels-photo-116717.jpeg)',
                            "background-size": "100vw 100vh"
                        });
                    } else if (desc === 'overcast clouds') {
                        $('body').css({
                            'background-image': 'url(http://www.nasa.gov/sites/default/files/thumbnails/image/smap-weather.jpg)',
                            'background-size': '100vw 100vh'
                        });
                    } else if (desc === 'broken clouds') {
                        $('body').css({
                            'background-image': 'url(https://static.pexels.com/photos/112065/pexels-photo-112065.jpeg)',
                            'background-size': '100vw 100vh'
                        });
                    } else if (desc === 'light rain' || desc === 'moderate rain' || desc === 'heavy rain') {
                        $('body').css({
                            'background-image': 'url(https://static.pexels.com/photos/39811/pexels-photo-39811.jpeg)',
                            'background-size': '100vw 100vh'
                        });
                    } else if (desc == 'light snow' || desc == 'moderate snow' || desc == 'heavy snow') {
                        $('body').css({
                            'background-image': 'url(https://static.pexels.com/photos/29845/pexels-photo-29845.jpg)',
                            'background-size': '100vw 100vh'
                        })
                    } else {
                        $('body').css({
                            'background-image': 'url(https://static.pexels.com/photos/6566/sea-sky-clouds-weather.jpg)',
                            'background-size': '100vw 100vh'
                        })
                    };
                },
                error: function(err) {
                    alert(err);
                }
            });

            $.getJSON("https://maps.googleapis.com/maps/api/geocode/json?latlng=" + latitude + "," + longitude + "&key=AIzaSyDduLo1-GPOYH6S5katr779jwWcSYQyEdc", function(data) {
                console.log(data);
                console.log(data.results[0].address_components[2].long_name);
                $('#area').html(data.results[0].address_components[2].long_name + " , " + data.results[0].address_components[4].long_name + " , " + data.results[0].address_components[6].long_name + " , " + data.results[0].address_components[7].long_name);
            });
            // $('#area').html(data.responseJSON.results[0].address_components[2].long_name);


            // $.ajax({
            //     url: "https://maps.googleapis.com/maps/api/geocode/json?latlng="+latitude+","+ longitude+"&key=AIzaSyDduLo1-GPOYH6S5katr779jwWcSYQyEdc",
            //     type: 'GET',
            //     dataType: 'jsonp',
            //     area: {},
            //     success: function(area) {
            //         console.log(area);
            //     },
            //     error: function() {
            //         console.log('could not fetch area');
            //     }
            // });
        }

        // if(window.navigatior.userAgent.includes('Chrome') === 'true'){
        // 	alert("Unfortunately Browsers such as chrome , Brave and Browsers in android doesn\'t support Geolocation , so Please view this app in Mozilla Firefox or Microsoft Edge or IE");
        // }else{
        	// callLocation();
        // }

        if(window.navigator.userAgent.includes('Chrome') == true){
        	alert("Unfortunately Browsers such as chrome , Brave and Browsers in android doesn\'t support Geolocation , so Please view this app in Mozilla Firefox or Microsoft Edge or IE");
        }else{
        	callLocation();
        };
    })
    </script>
</body>

</html>
<!-- Test Code for console-->
<!-- $.ajax({
  url : "http://api.openweathermap.org/data/2.5/forecast/city?id=524901&APPID=2898d089486f107dc2565963788c9842",
  dataType: 'jsonp',
  data: {},
  success: function(data){
    console.log(data);
  },
  error: function(err){
    console.log(err);
  }
}) -->
<!-- appid or key -->
<!-- 2898d089486f107dc2565963788c9842 -->
<!-- google api key -->
<!-- AIzaSyDduLo1-GPOYH6S5katr779jwWcSYQyEdc  -->
<!-- https://maps.googleapis.com/maps/api/geocode/json?latlng=12.981514899999999,77.5335631&key=AIzaSyDduLo1-GPOYH6S5katr779jwWcSYQyEdc -->
<!-- light rain -->
<!-- sky is clear -->
